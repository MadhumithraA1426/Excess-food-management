<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Excess Food Management - Login</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
<div class="container">
  <div class="app-shell">
    <div class="app-header">
      <div class="brand">
        <div class="brand-logo">E</div>
        <div class="brand-text">
          <h1>Excess Food</h1>
          <span>Share surplus â€¢ Reduce waste</span>
        </div>
      </div>
      <div class="header-actions">
        <div class="badge-pill">Node + TypeScript + SQLite</div>
      </div>
    </div>

    <div class="auth-layout">
      <section class="auth-hero">
        <h2 class="auth-hero-title">Connect donors with people in need.</h2>
        <p class="auth-hero-subtitle">
          Donors can list excess food with expiry time, and users can quickly discover available items before they go to waste.
        </p>
        <div class="hero-metrics">
          <div class="metric-pill">Auto-cleans expired food</div>
          <div class="metric-pill">Two roles: Donor & User</div>
          <div class="metric-pill">Simple, responsive UI</div>
        </div>
      </section>

      <section class="panel">
        <div class="panel-header">
          <div>
            <h2>Get started</h2>
            <p class="panel-subtitle">Register once, then log in with the same email.</p>
          </div>
          <span class="chip">Auth</span>
        </div>

        <div class="form-grid form-grid-full" style="margin-bottom: 12px;">
          <!-- Register -->
          <div class="form-group form-grid-full">
            <h3 style="margin:0 0 4px;font-size:14px;">Register</h3>
          </div>

          <form id="registerForm" class="form-grid form-grid-full">
            <div class="form-group form-grid-full">
              <label for="regName">Name</label>
              <input type="text" id="regName" placeholder="Your full name" required />
            </div>

            <div class="form-group form-grid-full">
              <label for="regEmail">Email</label>
              <input type="email" id="regEmail" placeholder="you@example.com" required />
            </div>

            <div class="form-group">
              <label for="regPassword">Password</label>
              <input type="password" id="regPassword" placeholder="Choose a strong password" required />
            </div>

            <div class="form-group">
              <label for="regRole">Role</label>
              <select id="regRole">
                <option value="user">User</option>
                <option value="donor">Donor</option>
              </select>
            </div>

            <div class="form-group form-grid-full">
              <button type="submit" class="btn-primary">
                Create account
              </button>
            </div>
          </form>

          <div class="form-group form-grid-full" style="margin-top: 10px;">
            <h3 style="margin:10px 0 4px;font-size:14px;">Login</h3>
          </div>

          <!-- Login -->
          <form id="loginForm" class="form-grid form-grid-full">
            <div class="form-group form-grid-full">
              <label for="logEmail">Email</label>
              <input type="email" id="logEmail" placeholder="you@example.com" required />
            </div>

            <div class="form-group form-grid-full">
              <label for="logPassword">Password</label>
              <input type="password" id="logPassword" placeholder="Your password" required />
            </div>

            <div class="form-group form-grid-full">
              <button type="submit" class="btn-primary">
                Continue
              </button>
            </div>
          </form>
        </div>
      </section>
    </div>
  </div>
</div>

<script>
const API_BASE = "/api";

document.getElementById("registerForm").addEventListener("submit", async (e) => {
  e.preventDefault();
  const form = e.target; // form reference
  const body = {
    name: document.getElementById("regName").value,
    email: document.getElementById("regEmail").value,
    password: document.getElementById("regPassword").value,
    role: document.getElementById("regRole").value,
  };
  const res = await fetch(API_BASE + "/auth/register", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(body),
  });
  const data = await res.json();
  alert(data.message || "Registered");

  if (res.ok) {
    form.reset(); // clear all fields after successful registration
  }
});

document.getElementById("loginForm").addEventListener("submit", async (e) => {
  e.preventDefault();
  const body = {
    email: document.getElementById("logEmail").value,
    password: document.getElementById("logPassword").value,
  };
  const res = await fetch(API_BASE + "/auth/login", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(body),
  });
  const data = await res.json();
  if (res.ok) {
    localStorage.setItem("token", data.token);
    localStorage.setItem("role", data.role);
    localStorage.setItem("name", data.name);
    window.location.href = "/dashboard.html";
  } else {
    alert(data.message || "Login failed");
  }
});
</script>
</body>
</html>
